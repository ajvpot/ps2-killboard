
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/static/bootstrap.js"></script>
    <style>
        .nc{
            background-color: #0080FF;
        }
        .tr{
            background-color: #D90005;
        }
        .vs{
            background-color: #92009D;
        }
        .ns{
            background-color: #212121;
        }
        td{
            color: #ffffff;
            background-color: #151515;
        }
        .vehicle{ /* ToDo: differentiate this from people */
            color: #ffffff;
        }
        table{
             table-layout: fixed;
        }
        .loading{
            color:#505050;
            background-image: url(static/ajax-loader.gif);
            background-repeat: no-repeat;
            background-size: contain;
        }
    </style>
    <script type="text/javascript">
        var sock = null;
        var ellog = null;
        window.onload = function() {
            ellog = document.getElementById('log');
            var wsuri;
            if (window.location.protocol === "file:") {
                wsuri = "ws://127.0.0.1:8080/ws";
            } else {
                wsuri = "ws://" + window.location.hostname + ":8080/ws";
            }
            if ("WebSocket" in window) {
                sock = new WebSocket(wsuri);
            } else if ("MozWebSocket" in window) {
                sock = new MozWebSocket(wsuri);
            } else {
                log("Browser does not support WebSocket!");
                window.location = "http://autobahn.ws/unsupportedbrowser";
            }
            if (sock) {
                sock.onopen = function() {
                    log("Connected to " + wsuri);
                }
                sock.onclose = function(e) {
                    log("Connection closed (wasClean = " + e.wasClean + ", code = " + e.code + ", reason = '" + e.reason + "')");
                    sock = null;
                }
                sock.onmessage = function(e) {

                    log("< " + e.data);
                    data = JSON.parse(e.data);
                    if(data['type'] == "parsed"){
                        if(data['event_name'] == "Death"){
                            html = '<tr id=event'+data['seq']+'>'
                            if(data['attacker']['resolved']==true){
                                html += '<td class="'+data['attacker']['faction']+'">'+ data['attacker']['disp'] +'</td>';
                            }else{
                                html += '<td class="loading">'+ data['attacker']['name'] +'</td>';
                            }
                            if(data['character']['resolved']==true){
                                html += '<td class="'+data['character']['faction']+'">'+ data['character']['disp'] +'</td>';
                            }else{
                                html += '<td class="loading">'+ data['character']['name'] +'</td>';
                            }

                            html += '<td>'+ data['attacker_weapon'] +'</td></tr>';

                            $('#killfeed tr:nth-child(2)').before(html);
                            // resolve attacker
                            // resolve attacked
                        }
                        if(data['event_name'] == "VehicleDestroy"){
                            html = '<tr id=event'+data['seq']+'>'
                            if(data['attacker']['resolved']==true){
                                html += '<td class="'+data['attacker']['faction']+'">'+ data['attacker']['disp'] +'</td>';
                            }else{
                                html += '<td>'+ data['attacker']['name'] +'</td>';
                            }
                            html += '<td class="vehicle '+data['faction']+'">'+ data['vehicle'] +'</td>';
                            html += '<td>'+ data['attacker_weapon'] +'</td></tr>';

                            $('#killfeed tr:nth-child(2)').before(html);
                            // resolve attacker
                        }
                    }else if(data['type'] == "resolve"){
                        $("td").filter(function() {
                            return $(this).text() == data['id'];
                        }).text(data['data']['disp']).addClass(data['data']['faction']).removeClass('loading');
                    }else if(data['type'] == "status"){
                         html = '<tr>';
                        html += '<td colspan=3>';
                        html += data['msg'];
                        html += '</td></tr>';
                        $('#killfeed tr:nth-child(2)').before(html);
                    }

                    $("#killfeed tr:gt(50)").remove();
                }
            }
        };
        function resolveCharacter(){

        }
        function send() {
            var msg = document.getElementById('message').value;
            if (sock) {
                sock.send(msg);
                log("> " + msg);
            } else {
                log("Not connected.");
            }
        };
        function log(m) {
            return;
            ellog.innerHTML += m + '\n';
            ellog.innerHTML=ellog.innerHTML.substring(ellog.innerHTML.length-10000,ellog.innerHTML.length);
            ellog.scrollTop = ellog.scrollHeight;

        };
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Navbar Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="navbar.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<div class="container">

    <!-- Static navbar -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Killboard</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
    </nav>


    <div class="row">
        <div class="col-md-12">
            <table id="killfeed" class="table">
                <tr>
                    <th >Attacker</th>
                    <th>Attacked</th>
                    <th>Weapon</th>
                </tr>
                <tr></tr>
            </table>
        </div>
    </div>

    <div class="row">
        <div clas="col-md-12">
            <pre id="log" style="height: 20em; overflow-y: scroll; background-color: #faa;"></pre>
        </div>
    </div>

</div> <!-- /container -->


</body>
</html>
















